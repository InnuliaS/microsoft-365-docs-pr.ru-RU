---
title: Смена или ротация ключа клиента или ключа доступности
ms.author: krowley
author: kccross
manager: laurawi
ms.date: 02/05/2020
audience: ITPro
ms.topic: article
ms.service: O365-seccomp
localization_priority: Normal
search.appverid:
- MET150
ms.collection:
- M365-security-compliance
description: Сведения о том, как выполнить сведение корневых ключей клиентов, хранящихся в Azure Key Vault, которые используются с ключом клиента. Службы включают в себя Exchange Online, Skype для бизнеса, SharePoint Online, OneDrive для бизнеса и файлы Teams.
ms.openlocfilehash: 29a36636253f5f01181f231941d0c3a9e26abacc
ms.sourcegitcommit: 2614f8b81b332f8dab461f4f64f3adaa6703e0d6
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/21/2020
ms.locfileid: "43633646"
---
# <a name="roll-or-rotate-a-customer-key-or-an-availability-key"></a>Смена или ротация ключа клиента или ключа доступности

> [!CAUTION]
> Изменяйте только ключ шифрования, который вы используете с ключом клиента, если требования к безопасности или соответствия требованиям заключаются в том, что необходимо выполнить эту проверку. Кроме того, не удаляйте ключи, которые не были связаны с политиками. При откате ключей будет использоваться содержимое, зашифрованное с помощью предыдущих ключей. Например, несмотря на то, что активные почтовые ящики будут повторно зашифрованы, неактивные, отключенные и отключенные почтовые ящики, могут быть зашифрованы с помощью предыдущих ключей. SharePoint Online выполняет резервное копирование контента для восстановления и восстановления, поэтому по-прежнему можно заархивировать содержимое, используя старые ключи.

## <a name="about-rolling-the-availability-key"></a>Сведения о том, как поменять ключ доступности

Корпорация Майкрософт не предоставляет клиентам прямой контроль над ключом доступности. Например, можно выполнить только сведение (поворот) ключей, которыми вы владеете в Azure Key Vault. Microsoft 365 выполняет откат ключей доступности по внутреннему расписанию. Для этих полных этапов не существует соглашения об уровне обслуживания (SLA). Microsoft 365 поворачивает ключ доступности с помощью кода службы Microsoft 365 в автоматическом, не выполняемом вручную процессе. Администраторы Майкрософт могут инициировать процесс развертывания. Этот ключ выполняет откат с помощью автоматизированных механизмов без прямого доступа к хранилищу ключей. Доступ к защищенному хранилищу ключа доступности не предоставлены администраторам Майкрософт. С помощью ключа доступности можно использовать тот же механизм, что и для первоначального создания ключа. Дополнительные сведения о ключе доступности приведены в разделе [сведения о ключе доступности](customer-key-availability-key-understand.md).

> [!IMPORTANT]
> Ключи доступности Exchange Online и Skype для бизнеса могут быть эффективно собраны клиентами, создающими новую функцию DEP, так как для каждой создаваемой функции DEP создается уникальный ключ доступности. Ключи доступности для SharePoint Online, OneDrive для бизнеса и файлов Teams существуют на уровне леса и совместно используются в ДЕПС и клиентах, что означает, что развертывание выполняется только в определенном по внутреннем расписании Майкрософт. Чтобы уменьшить риск невозможности переносить ключ доступности при каждом создании новой функции DEP, SharePoint, OneDrive и Teams выявляют промежуточный ключ клиента (тик), ключ, заключенный в корневые ключи клиента и ключ доступности, каждый раз, когда создается новая функция DEP.

## <a name="request-a-new-version-of-each-existing-root-key-you-want-to-roll"></a>Запросите новую версию каждого существующего корневого ключа, который необходимо восстановить.

При выполнении отката ключа вы запрашиваете новую версию существующего ключа. Чтобы запросить новую версию существующего ключа, используйте тот же командлет [Add – азкэйваулткэй](https://docs.microsoft.com/powershell/module/az.keyvault/add-azkeyvaultkey)с тем же синтаксисом, который использовался для создания ключа в первую очередь. После того, как вы закончите все ключи, связанные с политикой шифрования данных (DEP), запустите другой командлет, чтобы убедиться, что ключ клиента начинает использовать новый ключ. Выполните это действие в каждом хранилище ключей Azure (АКВ).

Например:

1. Войдите в свою подписку на Azure с помощью Azure PowerShell. Инструкции можно найти [в разделе Вход с помощью Azure PowerShell](https://docs.microsoft.com/powershell/azure/authenticate-azureps).

2. Запустите командлет Add – Азкэйваулткэй, как показано в следующем примере:

   ```powershell
   Add-AzKeyVaultKey -VaultName Contoso-O365EX-NA-VaultA1 -Name Contoso-O365EX-NA-VaultA1-Key001 -Destination HSM -KeyOps @('wrapKey','unwrapKey') -NotBefore (Get-Date -Date "12/27/2016 12:01 AM")
   ```

   В этом примере, так как ключ с именем **contoso – O365EX — Na – VaultA1 – Key001** существует в хранилище **contoso — O365EX, Na/VaultA1** , командлет создает новую версию ключа. Эта операция сохраняет предыдущие основные версии в журнале версий для ключа. Для расшифровки данных, которые по-прежнему шифруются, необходима предыдущая версия ключа. После выполнения всех ключей, связанных с функцией DEP, выполните дополнительный командлет, чтобы убедиться, что ключ клиента начинает использовать новый ключ. В следующих разделах более подробно описаны командлеты.
  
## <a name="update-the-customer-key-for-exchange-online-and-skype-for-business"></a>Обновление ключа клиента для Exchange Online и Skype для бизнеса

При выполнении одного из ключей Azure Key Vault, связанных с DEP, используемым в Exchange Online и Skype для бизнеса, необходимо обновить DEP, чтобы указать на новый ключ. При этом ключ доступности не поворачивается.

Чтобы ключ клиента использовал новый ключ для шифрования почтовых ящиков, выполните командлет Set – Dataencryptionpolicy используется следующим образом:

1. Выполните командлет Set – Dataencryptionpolicy используется в Azure PowerShell:
  
   ```powershell
   Set-DataEncryptionPolicy -Identity <DataEncryptionPolicyID> -Refresh
   ```

   В течение 72 часов активные почтовые ящики, связанные с этой функцией DEP, будут зашифрованы с помощью нового ключа.

2. Чтобы проверить значение свойства Датаенкриптионполициид почтового ящика, выполните действия, описанные в статье [Определение функции DEP, назначенного почтовому ящику](customer-key-manage.md#determine-the-dep-assigned-to-a-mailbox). Значение этого свойства изменяется, когда служба применяет обновленный ключ.
  
## <a name="update-the-customer-key-for-sharepointonlineonedriveforbusinessandteamsfiles"></a>Обновление ключа клиента для SharePoint Online, OneDrive для бизнеса и файлов Teams

SharePoint Online позволяет выполнять только один ключ за раз. Если вы хотите выполнить накат обоих ключей в хранилище ключей, дождитесь завершения первой операции. Корпорация Майкрософт рекомендует по мере необходимости отключать операции, чтобы избежать этой ситуации. При выполнении одного из ключей Azure Key Vault, связанных с DEP, используемым в SharePoint Online и OneDrive для бизнеса, необходимо обновить DEP, чтобы указать на новый ключ. При этом ключ доступности не поворачивается.

1. Выполните командлет Update – Сподатаенкриптионполици следующим образом:
  
   ```powershell
   Update-SPODataEncryptionPolicy -Identity <SPOAdminSiteUrl> -KeyVaultName <ReplacementKeyVaultName> -KeyName <ReplacementKeyName> -KeyVersion <ReplacementKeyVersion> -KeyType <Primary | Secondary>
   ```

   Несмотря на то, что этот командлет запускает операцию key для SharePoint Online и OneDrive для бизнеса, действие не завершается немедленно.

2. Чтобы просмотреть ход выполнения операции с ключом, выполните командлет Get – Сподатаенкриптионполици следующим образом:

   ```powershell
   Get-SPODataEncryptionPolicy -Identity <SPOAdminSiteUrl>
   ```

## <a name="related-articles"></a>Связанные статьи

- [Шифрование службы с помощью ключа клиента для Office 365](customer-key-overview.md)

- [Настройка ключа клиента для Office 365](customer-key-set-up.md)

- [Управление ключом клиента для Office 365](customer-key-manage.md)

- [Сведения о ключе доступности](customer-key-availability-key-understand.md)
