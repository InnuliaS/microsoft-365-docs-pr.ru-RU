---
title: Работать с расширенными результатами запроса поиска при поиске в Microsoft Threat protection
description: Предоставление большей части результатов запроса, возвращаемых расширенным поиском в защите от угроз Майкрософт
keywords: Расширенный поиск, Поиск угроз, Поиск угроз кибератак, защита от угроз Майкрософт, Microsoft 365, MTP, m365, поиск, запрос, телеметрии, пользовательские обнаружения, схема, Кусто, Microsoft 365, защита от угроз Майкрософт, визуализация, диаграмма, фильтры, детализация
search.product: eADQiWindows 10XVcnh
search.appverid: met150
ms.prod: microsoft-365-enterprise
ms.mktglfcycl: deploy
ms.sitesec: library
ms.pagetype: security
f1.keywords:
- NOCSH
ms.author: lomayor
author: lomayor
ms.localizationpriority: medium
manager: dansimp
audience: ITPro
ms.collection: M365-security-compliance
ms.topic: article
ms.openlocfilehash: f9838908ca0dbfb498601c3509b920b064a2eb22
ms.sourcegitcommit: 3b2fdf159d7dd962493a3838e3cf0cf429ee2bf2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/24/2020
ms.locfileid: "42929246"
---
# <a name="work-with-advanced-hunting-query-results"></a>Работать с расширенными результатами запроса поиска

**Область применения:**
- Защита от угроз (Майкрософт)

[!INCLUDE [Prerelease information](../includes/prerelease.md)]

Несмотря на то, что [Расширенные](advanced-hunting-overview.md) запросы поиска можно создавать для получения очень точной информации, вы также можете работать с результатами запроса, чтобы получить дополнительные сведения и исследовать конкретные действия и индикаторы. В результатах запроса можно выполнить следующие действия:

- Просмотр результатов в виде таблицы или диаграммы
- Экспорт таблиц и диаграмм
- Детализация подробных сведений об объекте
- Настройка запросов непосредственно из результатов или применение фильтров

## <a name="view-query-results-as-a-table-or-chart"></a>Просмотр результатов запроса в виде таблицы или диаграммы
По умолчанию при расширенном поиске отображаются результаты запроса в виде табличных данных. Вы также можете отображать одни и те же данные в виде диаграммы. Расширенный поиск поддерживает следующие представления:

| Тип представления | Описание |
| -- | -- |
| **Table** | Отображает результаты запроса в табличном формате |
| **Гистограмма** | Отображает ряд уникальных элементов на оси x как вертикальные полосы, высота которых представляет числовые значения из другого поля |
| **Гистограмма с накоплением** | Отрисовывает ряд уникальных элементов на оси x в виде вертикальных полос с накоплением, высота которых представляет числовые значения из одного или нескольких других полей |
| **Круговая диаграмма** | Отображает секторы, представляющие уникальные элементы. Размер каждого круга представляет числовые значения из другого поля. |
| **Кольцевой график** | Отображает разделы, представляющие уникальные элементы. Длина каждой дуги представляет числовые значения из другого поля. |
| **График** | Отображает числовые значения для ряда уникальных элементов и соединяет значения, которые отображаются на диаграмме. |
| **Точечная диаграмма** | Отображает числовые значения для ряда уникальных элементов |
| **Диаграмма с областями** | Отображает числовые значения для ряда уникальных элементов и заполняет разделы под выводимыми значениями |

### <a name="construct-queries-for-effective-charts"></a>Создание запросов для эффективных диаграмм
При отображении диаграмм Расширенный поиск автоматически определяет интересующие столбцы и числовые значения для статистической обработки. Чтобы получить осмысленные диаграммы, создайте запросы для возврата определенных значений, которые необходимо отобразить в визуальном виде. Ниже приведено несколько примеров запросов и результирующих диаграмм.

#### <a name="alerts-by-severity"></a>Оповещения по степени серьезности
С помощью `summarize` оператора можно получить числовое количество значений, которые вы хотите создать в диаграмме. В приведенном ниже запросе `summarize` используется оператор, чтобы получить количество оповещений по степени серьезности.

```kusto
AlertInfo
| summarize Total = count() by Severity
```
При отображении результатов на гистограмме значения степени серьезности отображаются как отдельный столбец.

![Изображение результатов запроса поиска с расширенным поиском в виде](../../media/advanced-hunting-column-chart.jpg)
гистограммы*результаты запроса для оповещений по уровню серьезности отображаются в виде* гистограммы

#### <a name="alert-severity-by-operating-system"></a>Серьезность оповещений по операционной системе
Кроме того, можно использовать `summarize` оператор, чтобы подготовить результаты для значений диаграмм из нескольких полей. Например, вам может потребоваться определить, как серьезность оповещений распределяется между операционными системами (ОС). 

Приведенный ниже запрос использует `join` `DeviceInfo` оператор для получения сведений о ОС из таблицы, а затем использует `summarize` для подсчета значений в столбцах `Severity` `OSPlatform` и.

```kusto
AlertInfo
| join AlertEvidence on AlertId
| join DeviceInfo on DeviceId
| summarize Count = count() by OSPlatform, Severity 
```
Эти результаты лучше всего подходят для наглядной гистограммы с накоплением:

![Изображение результатов запроса поиска с накоплением в виде диаграммы](../../media/advanced-hunting-stacked-chart.jpg)
с накоплением*результатов запроса для оповещений по операционной системе и уровню серьезности, отображаемым в виде диаграммы с накоплением*

#### <a name="phishing-emails-across-top-ten-sender-domains"></a>Фишинговые сообщения через десять доменов отправителей
Если вы работаете со списком неконечных значений, вы можете использовать `Top` оператор, чтобы отобразить только значения с наибольшим количеством экземпляров. Например, чтобы получить первые десять доменов отправителей с наиболее поддельными сообщениями, используйте следующий запрос:

```kusto
EmailEvents
| where PhishFilterVerdict == "Phish"
| summarize Count = count() by SenderFromDomain
| top 10 by Count
```
Используйте представление круговой диаграммы для эффективного отображения распределения между верхними доменами:

![Изображение результатов расширенного поиска поиска, отображаемое в виде](../../media/advanced-hunting-pie-chart.jpg)
круговой диаграммы с*распределением фишинговых сообщений между верхними доменами отправителя*

#### <a name="file-activities-over-time"></a>Действия с файлами с течением времени
С помощью `summarize` оператора с `bin()` функцией можно проверить наличие событий, связанных с определенным индикатором, с течением времени. В запросе ниже показано, как подсчитывает события `invoice.doc` , связанные с файлом, с интервалом в 30 минут, чтобы показать пиковые действия, связанные с этим файлом:

```kusto
AppFileEvents
| union DeviceFileEvents
| where FileName == "invoice.doc"
| summarize FileCount = count() by bin(Timestamp, 30m)
```
На графике ниже показано, как четко выделить периоды времени с большим количеством действий, включающих `invoice.doc`в себя: 

![Изображение результатов расширенного поиска поиска, отображаемое в виде](../../media/advanced-hunting-line-chart.jpg)
линейного графика, которое*показывает количество событий, связанных с файлом* , с течением времени


## <a name="export-tables-and-charts"></a>Экспорт таблиц и диаграмм
После выполнения запроса нажмите кнопку **Экспорт** , чтобы сохранить результаты в локальный файл. Выбранное представление определяет, как будут экспортироваться результаты.

- **Представление таблицы** — результаты запроса экспортируются в табличную форму в виде книги Microsoft Excel
- **Любая диаграмма** — результаты запроса экспортируются в виде изображения в формате JPEG для визуализированной диаграммы

## <a name="drill-down-from-query-results"></a>Детализация результатов запроса
Чтобы просмотреть дополнительные сведения об объектах в результатах поиска по запросу, например, компьютерах, файлах, пользователях, IP-адресах и URL-адресах, нужно просто щелкнуть идентификатор объекта. Открывается страница c данными профиля выбранного объекта в центре безопасности Microsoft Defender.

## <a name="tweak-your-queries-from-the-results"></a>Регулирование запросов на основе результатов
Чтобы оперативно улучшить свой запрос, нужно щелкнуть правой кнопкой мыши одно из значений в полученном наборе результатов. Предлагаемые варианты можно использовать для

- открытого поиска избранного значения (`==`)
- исключения избранного значения из запроса (`!=`)
- Чтобы добавить к своему запросу определенное значение, можно использовать дополнительные операторы, например, `contains`, `starts with` и`ends with` 

![Изображение расширенного набора результатов поиска](../../media/advanced-hunting-results-filter.png)

## <a name="filter-the-query-results"></a>Фильтрация результатов запроса
Используя отображаемые справа фильтры, можно сформировать сводку о полученном наборе результатов. В каждом столбце есть раздел, в котором приводятся уникальные обнаруженные для этого столбца значения и количество экземпляров.

Уточните свой запрос, нажав кнопку `+` или `-` на значения, которые нужно включить или исключить, а затем выбрав **выполнить запрос**.

![Изображение фильтра расширенного выслеживания](../../media/advanced-hunting-filter.png)

Использование фильтра с целью изменения запроса и отправка этого запроса позволяют получить новые соответствующие результаты.

## <a name="related-topics"></a>См. также
- [Обзор расширенной охоты на угрозы](advanced-hunting-overview.md)
- [Изучение языка запросов](advanced-hunting-query-language.md)
- [Использование общих запросов](advanced-hunting-shared-queries.md)
- [Поиск угроз на устройствах и в сообщениях электронной почты](advanced-hunting-query-emails-devices.md)
- [Сведения о схеме](advanced-hunting-schema-tables.md)
- [Рекомендации по применению запросов](advanced-hunting-best-practices.md)
- [Обзор настраиваемых обнаружений](custom-detections-overview.md)
